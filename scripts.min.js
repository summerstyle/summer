function SummerHtmlImageMapCreator(){"use strict";function u(){var e=null;e=localStorage.getItem("SummerHTMLImageMapCreator_settings");if(e==null){e={settings_auto_close_edit:true}}else{try{e=JSON.parse(e)}catch(t){console.log(t);console.log(e);e={settings_auto_close_edit:true}}}return e}function c(e,t,n){this.target=e;this.eventType=t;this.func=n;e.addEventListener(t,n,false)}function h(e,t,n){this.helper=document.createElementNS("http://www.w3.org/2000/svg","rect");this.helper.setAttribute("class","helper");this.helper.setAttribute("height",5);this.helper.setAttribute("width",5);this.helper.setAttribute("x",t-3);this.helper.setAttribute("y",n-3);e.appendChild(this.helper)}var e={offsetX:function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset;return Math.round(t.left+n)},offsetY:function(e){var t=e.getBoundingClientRect(),n=window.pageYOffset;return Math.round(t.top+n)},rightX:function(e){return e-t.getOffset("x")},rightY:function(e){return e-t.getOffset("y")},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},id:function(e){return document.getElementById(e)},hide:function(e){e.style.display="none";return this},show:function(e){e.style.display="block";return this},encode:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")},foreach:function(e,t){for(var n=0,r=e.length;n<r;n++){t(e[n],n)}},foreachReverse:function(e,t){for(var n=e.length-1;n>=0;n--){t(e[n],n)}},debug:function(){var e=document.getElementById("debug");return function(){e.innerHTML=[].join.call(arguments," ")}}(),stopEvent:function(e){e.stopPropagation();e.preventDefault();return this},addClass:function(t,n){var r=t.className.baseVal!==undefined?true:false,i=r?t.className.baseVal.split(" "):t.className.split(" "),s=false;e.foreach(i,function(e){if(e===n){s=true}});if(!s){i.push(n);r?t.className.baseVal=i.join(" "):t.className=i.join(" ")}return this},removeClass:function(t,n){var r=t.className.baseVal!==undefined?true:false,i=r?t.className.baseVal.split(" "):t.className.split(" "),s=false;e.foreach(i,function(e,t){if(e===n){s=true;i.splice(t--,1)}});if(s){r?t.className.baseVal=i.join(" "):t.className=i.join(" ")}return this},hasClass:function(t,n){var r=t.className.baseVal!==undefined?true:false,i=r?t.className.baseVal.split(" "):t.className.split(" "),s=false;e.foreach(i,function(e){if(e===n){s=true}});return s},extend:function(e,t){var n={};for(name in e){if(e.hasOwnProperty(name)){n[name]=t[name]?t[name]:e[name]}}return n},supportFileReader:function(){return typeof FileReader!=="undefined"}()};var t=function(){function O(){y.x=e.offsetX(h);y.y=e.offsetY(h)}function M(n){if(E==="editing"){if(n.target.parentNode.tagName==="g"){i.unload();T=n.target.parentNode.obj;t.deselectAll();T.select();T.delta={x:n.pageX,y:n.pageY};if(e.hasClass(n.target,"helper")){var r=n.target;N=r.action;if(r.n>=0){T.selected_point=r.n}t.addEvent(h,"mousemove",T.onEdit).addEvent(h,"mouseup",T.onEditStop)}else if(n.target.tagName==="rect"||n.target.tagName==="circle"||n.target.tagName==="polygon"){N="move";t.addEvent(h,"mousemove",T.onEdit).addEvent(h,"mouseup",T.onEditStop)}}else{t.deselectAll();i.unload()}}}function _(n){if(E==="drawing"&&!w&&b){r.hide();switch(b){case"rect":x=new p(e.rightX(n.pageX),e.rightY(n.pageY));t.addEvent(h,"mousemove",x.onDraw).addEvent(h,"click",x.onDrawStop);break;case"circle":x=new d(e.rightX(n.pageX),e.rightY(n.pageY));t.addEvent(h,"mousemove",x.onDraw).addEvent(h,"click",x.onDrawStop);break;case"polygon":x=new v(e.rightX(n.pageX),e.rightY(n.pageY));t.addEvent(h,"mousemove",x.onDraw).addEvent(h,"click",x.onDrawAddPoint).addEvent(document,"keydown",x.onDrawStop).addEvent(x.helpers[0].helper,"click",x.onDrawStop);break}}}function D(){window.focus()}function P(e){if(E==="editing"){if(e.target.tagName==="rect"||e.target.tagName==="circle"||e.target.tagName==="polygon"){T=e.target.parentNode.obj;i.load(T,e.pageX,e.pageY)}}}function H(e){switch(e.keyCode){case A.F1:n.show();e.preventDefault();break;case A.ESC:n.hide();if(w){w=false;x.remove();S.pop();t.removeAllEvents()}else if(E==="editing"){T.redraw();t.removeAllEvents()}break;case A.TOP:if(E==="editing"&&T){T.setParams(T.dynamicEdit(T["move"](0,-1)));e.preventDefault()}break;case A.BOTTOM:if(E==="editing"&&T){T.setParams(T.dynamicEdit(T["move"](0,1)));e.preventDefault()}break;case A.LEFT:if(E==="editing"&&T){T.setParams(T.dynamicEdit(T["move"](-1,0)));e.preventDefault()}break;case A.RIGHT:if(E==="editing"&&T){T.setParams(T.dynamicEdit(T["move"](1,0)));e.preventDefault()}break;case A.DELETE:if(E==="editing"&&T){t.removeObject(T);T=null;i.unload()}break;case A.I:if(E==="editing"&&T){var r=T.params,s=r.x||r.cx||r[0],o=r.y||r.cy||r[1];i.load(T,s+t.getOffset("x"),o+t.getOffset("y"))}break;case A.S:t.saveInLocalStorage();break}}var s=document.getElementsByTagName("body")[0],o=e.id("wrapper"),u=e.id("svg"),a=e.id("img"),l=null,h=e.id("image"),m=e.id("about"),g=e.id("coords"),y={x:0,y:0},b=null,w=false,E=null,S=[],x=null,T=null,N,C=[],k,L,A={F1:112,ESC:27,TOP:38,BOTTOM:40,LEFT:37,RIGHT:39,DELETE:46,I:73,S:83};window.addEventListener("resize",O,false);h.addEventListener("mousedown",function(e){e.preventDefault()},false);a.addEventListener("dragstart",function(e){e.preventDefault()},false);h.addEventListener("mousemove",function(t){g.innerHTML="x: "+e.rightX(t.pageX)+", "+"y: "+e.rightY(t.pageY)},false);h.addEventListener("mouseleave",function(){g.innerHTML=""},false);h.addEventListener("mousedown",M,false);h.addEventListener("click",_,false);if(window.navigator.appName==="Opera"){h.addEventListener("mousedown",D,false);h.addEventListener("mouseup",D,false);h.addEventListener("click",D,false);h.addEventListener("dblclick",D,false)}h.addEventListener("dblclick",P,false);document.addEventListener("keydown",H,false);return{saveInLocalStorage:function(){var t={areas:[],img:l};e.foreach(S,function(e){t.areas.push(e.toJSON())});window.localStorage.setItem("SummerHTMLImageMapCreator",JSON.stringify(t));alert("Saved");return this},loadFromLocalStorage:function(){var t=window.localStorage.getItem("SummerHTMLImageMapCreator"),n=JSON.parse(t),r=n.areas;this.loadImage(n.img);e.foreach(r,function(e){switch(e.type){case"rect":if(e.coords.length===4){p.createFromSaved({coords:e.coords,href:e.href,alt:e.alt,title:e.title})}break;case"circle":if(e.coords.length===3){d.createFromSaved({coords:e.coords,href:e.href,alt:e.alt,title:e.title})}break;case"polygon":if(e.coords.length>=6&&e.coords.length%2===0){v.createFromSaved({coords:e.coords,href:e.href,alt:e.alt,title:e.title})}break}});return this},hide:function(){e.hide(o);return this},show:function(){e.show(o);return this},recalcOffsetValues:function(){O();return this},setDimensions:function(e,t){u.setAttribute("width",e);u.setAttribute("height",t);h.style.width=e+"px";h.style.height=t+"px";return this},loadImage:function(e){f.showLoadIndicator();a.src=e;l=e;a.onload=function(){f.hideLoadIndicator().hide();t.show().setDimensions(a.width,a.height).recalcOffsetValues()};return this},preview:function(){a.setAttribute("usemap","#map");k=document.createElement("map");k.setAttribute("name","map");h.appendChild(k);return function(){i.unload();t.setShape(null);e.hide(u);k.innerHTML=t.getHTMLCode();r.print();return this}}(),hidePreview:function(){e.show(u);k.innerHTML="";return this},addNodeToSvg:function(e){u.appendChild(e);return this},removeNodeFromSvg:function(e){u.removeChild(e);return this},getOffset:function(e){switch(e){case"x":return y.x;break;case"y":return y.y;break}return undefined},clear:function(){S.length=0;while(u.childNodes[0]){u.removeChild(u.childNodes[0])}r.hide();i.unload();return this},removeObject:function(t){e.foreach(S,function(e,n){if(e===t){S.splice(n,1)}});t.remove();return this},deselectAll:function(){e.foreach(S,function(e){e.deselect()});return this},getIsDraw:function(){return w},setIsDraw:function(e){w=e;return this},setMode:function(e){E=e;return this},getMode:function(){return E},setShape:function(e){b=e;return this},getShape:function(){return b},addObject:function(e){S.push(e);return this},getNewArea:function(){return x},resetNewArea:function(){x=null;return this},getSelectedArea:function(){return T},setSelectedArea:function(e){T=e;return this},getEditType:function(){return N},setFilename:function(e){L=e;return this},setEditClass:function(){e.removeClass(h,"draw").addClass(h,"edit");return this},setDrawClass:function(){e.removeClass(h,"edit").addClass(h,"draw");return this},setDefaultClass:function(){e.removeClass(h,"edit").removeClass(h,"draw");return this},addEvent:function(e,t,n){C.push(new c(e,t,n));return this},removeAllEvents:function(){e.foreach(C,function(e){e.remove()});C.length=0;return this},getHTMLCode:function(t){var n="";if(t){if(!S.length){return"0 objects"}n+=e.encode('<img src="'+L+'" alt="" usemap="#map" />')+"<br />"+e.encode('<map name="map">')+"<br />";e.foreachReverse(S,function(t){n+="&nbsp;&nbsp;&nbsp;&nbsp;"+e.encode(t.toString())+"<br />"});n+=e.encode("</map>")}else{e.foreachReverse(S,function(e){n+=e.toString()})}return n}}}();var n=function(){function i(){e.hide(t);e.hide(n)}function s(){e.show(t);e.show(n)}var t=e.id("help"),n=e.id("overlay"),r=t.querySelector(".close_button");n.addEventListener("click",i,false);r.addEventListener("click",i,false);return{show:s,hide:i}}();var r=function(){var n=e.id("code"),r=e.id("code_content"),i=n.querySelector(".close_button");i.addEventListener("click",function(t){e.hide(n);t.preventDefault()},false);return{print:function(){r.innerHTML=t.getHTMLCode(true);e.show(n)},hide:function(){e.hide(n)}}}();var i=function(){function g(){e.removeClass(n,"changed");e.foreach(c,function(t){e.removeClass(t,"changed")})}function y(e){h.href=i.value;h.alt=s.value;h.title=u.value;h.href?h.with_href():h.without_href();if(o.settings_auto_close_edit){w()}e.preventDefault()}function b(e){i.value="";s.value="";u.value="";g();e.preventDefault()}function w(){h=null;g();e.hide(n)}function E(e,t){n.style.left=e+5+"px";n.style.top=t+5+"px"}function S(e){E(p+e.pageX-v,d+e.pageY-m)}function x(e){p=p+e.pageX-v;d=d+e.pageY-m;E(p,d);t.removeAllEvents()}function T(){e.addClass(n,"changed");e.addClass(this.parentNode,"changed")}var n=e.id("edit_details"),r=n.querySelector("h5"),i=e.id("href_attr"),s=e.id("alt_attr"),u=e.id("title_attr"),a=e.id("save_details"),f=e.id("details_clear"),l=n.querySelector(".close_button"),c=n.querySelectorAll("p"),h,p,d,v,m;a.addEventListener("click",y,false);f.addEventListener("click",b,false);i.addEventListener("keydown",function(e){e.stopPropagation()},false);s.addEventListener("keydown",function(e){e.stopPropagation()},false);u.addEventListener("keydown",function(e){e.stopPropagation()},false);i.addEventListener("change",T,false);s.addEventListener("change",T,false);u.addEventListener("change",T,false);l.addEventListener("click",w,false);r.addEventListener("mousedown",function(e){v=e.pageX,m=e.pageY;t.addEvent(document,"mousemove",S);t.addEvent(r,"mouseup",x);e.preventDefault()},false);return{load:function(t,r,o){h=t;i.value=t.href?t.href:"";s.value=t.alt?t.alt:"";u.value=t.title?t.title:"";e.show(n);if(r&&o){p=r;d=o;E(p,d)}},unload:w}}();var s=function(){function f(e){var t,n,r,i,f,l,h,m,g,y,b=false;if(e){t=s.exec(e);while(t){b=true;h=t[0];f=t[1];l=t[2].split(/ ?, ?/);n=o.exec(h);if(n){m=n[1]}else{m=""}r=u.exec(h);if(r){g=r[1]}else{g=""}i=a.exec(h);if(i){y=i[1]}else{y=""}for(var w=0,E=l.length;w<E;w++){l[w]=Number(l[w])}switch(f){case"rect":if(l.length===4){p.createFromSaved({coords:l,href:m,alt:g,title:y})}break;case"circle":if(l.length===3){d.createFromSaved({coords:l,href:m,alt:g,title:y})}break;case"poly":if(l.length>=6&&l.length%2===0){v.createFromSaved({coords:l,href:m,alt:g,title:y})}break}t=s.exec(e)}if(b){c()}}}function l(e){f(n.value);e.preventDefault()}function c(){e.hide(t)}var t=e.id("from_html_wrapper"),n=e.id("code_input"),r=e.id("load_code_button"),i=t.querySelector(".close_button"),s=/<area(?=.*? shape="(rect|circle|poly)")(?=.*? coords="([\d ,]+?)")[\s\S]*?>/gmi,o=/ href="([\S\s]+?)"/,u=/ alt="([\S\s]+?)"/,a=/ title="([\S\s]+?)"/;r.addEventListener("click",l,false);i.addEventListener("click",c,false);return{show:function(){n.value="";e.show(t)},hide:c}}();var o=u();var a=function(){function a(e){if(e.type==="checkbox"){return e.checked}return e.value}function f(e,t){if(e.type==="checkbox"){e.checked=t}else{e.value=t}}function l(){for(u in o){f(n[u],o[u])}e.show(t)}function c(e){e.preventDefault();for(u in o){o[u]=a(n[u])}localStorage.setItem("SummerHTMLImageMapCreator_settings",JSON.stringify(o));p()}function h(e){e.preventDefault();for(u in n){f(n[u],n[u].getAttribute("data - default"))}}function p(){e.hide(t)}var t=e.id("summer_settings"),n={settings_auto_close_edit:e.id("settings_auto_close_edit")},r=t.querySelector(".close_button"),i=e.id("settings_save"),s=e.id("settings_reset"),u=null;i.addEventListener("click",c,false);r.addEventListener("click",p,false);s.addEventListener("click",h,false);return{show:l,hide:p}}();var f=function(){function f(){e.hide(r);u.init();a.init()}function l(){u.clear();a.clear();o=null}function c(e){if(o===a&&a.test()){t.loadImage(a.getImage()).setFilename(s)}else if(o===u&&u.test()){t.loadImage(u.getImage()).setFilename(s)}e.preventDefault()}var n=e.id("get_image_wrapper"),r=e.id("loading"),i=e.id("button"),s=null,o=null;var u=function(){function i(e){switch(e){case"image/jpeg":case"image/gif":case"image/png":return true;break}return false}function f(){r.src="";e.hide(r).hide(n).removeClass(t,"error");o=a}var t=e.id("dropzone"),n=t.querySelector(".clear_button"),r=e.id("sm_img");if(!e.supportFileReader){e.hide(e.id("file_reader_support"))}t.addEventListener("dragover",function(t){e.stopEvent(t)},false);t.addEventListener("dragleave",function(t){e.stopEvent(t)},false);t.addEventListener("drop",function(a){e.stopEvent(a);var l=new FileReader,c=a.dataTransfer.files[0];if(i(c.type)){e.removeClass(t,"error");l.readAsDataURL(c);l.onload=function(t){r.src=t.target.result;r.style.display="inline - block";s=c.name;e.show(n);o=u}}else{f();e.addClass(t,"error")}},false);n.addEventListener("click",f,false);return{clear:f,init:function(){t.draggable=true;this.clear();e.hide(r).hide(n)},test:function(){return r.src?true:false},getImage:function(){return r.src}}}();var a=function(){function r(t){var n=e.trim(t),r=n.split("."),i;if(r.length>1){i=r[r.length-1].toLowerCase();switch(i){case"jpg":case"jpeg":case"gif":case"png":return true;break}}return false}function i(){setTimeout(function(){if(t.value.length){e.show(n);o=a}else{e.hide(n);o=u}},0)}function f(){t.value="";e.hide(n);e.removeClass(t,"error");o=a}var t=e.id("url"),n=t.parentNode.querySelector(".clear_button");t.addEventListener("keypress",i,false);t.addEventListener("change",i,false);t.addEventListener("paste",i,false);n.addEventListener("click",f,false);return{clear:f,init:function(){this.clear();e.hide(n)},test:function(){if(r(t.value)){e.removeClass(t,"error");return true}else{e.addClass(t,"error")}return false},getImage:function(){var n=t.value.split("/");s=n[n.length-1];return e.trim(t.value)}}}();f();i.addEventListener("click",c,false);return{show:function(){l();e.show(n);return this},hide:function(){e.hide(n);return this},showLoadIndicator:function(){e.show(r);return this},hideLoadIndicator:function(){e.hide(r);return this}}}();var l=function(){function S(){e.foreach(o,function(t){e.removeClass(t,"selected")})}function x(t){S();e.addClass(t,"selected")}function T(e){t.saveInLocalStorage();e.preventDefault()}function N(e){t.clear().loadFromLocalStorage();e.preventDefault()}function C(e){t.setMode("drawing").setDrawClass().setShape(this.id).deselectAll().hidePreview();i.unload();x(this);e.preventDefault()}function k(e){if(confirm("Clear all?")){t.setMode(null).setDefaultClass().setShape(null).clear().hidePreview();S()}e.preventDefault()}function L(e){s.show();e.preventDefault()}function A(e){a.show();e.preventDefault()}function O(e){i.unload();r.print();e.preventDefault()}function M(e){if(t.getMode()==="preview"){t.setMode(null).hidePreview();S()}else{t.deselectAll().setMode("preview").setDefaultClass().preview();x(this)}e.preventDefault()}function _(n){if(t.getMode()==="editing"){t.setMode(null).setDefaultClass().deselectAll();S();e.show(svg)}else{t.setShape(null).setMode("editing").setEditClass();x(this)}t.hidePreview();n.preventDefault()}function D(e){if(confirm("Discard all changes?")){t.setMode(null).setDefaultClass().setShape(null).setIsDraw(false).clear().hide().hidePreview();S();f.show()}e.preventDefault()}function P(e){n.show();e.preventDefault()}var o=e.id("nav").getElementsByTagName("li"),u=e.id("save"),l=e.id("load"),c=e.id("rect"),h=e.id("circle"),p=e.id("polygon"),d=e.id("edit"),v=e.id("clear"),m=e.id("from_html"),g=e.id("to_html"),y=e.id("preview"),b=e.id("new_image"),w=e.id("show_settings"),E=e.id("show_help");u.addEventListener("click",T,false);l.addEventListener("click",N,false);c.addEventListener("click",C,false);h.addEventListener("click",C,false);p.addEventListener("click",C,false);v.addEventListener("click",k,false);m.addEventListener("click",L,false);g.addEventListener("click",O,false);y.addEventListener("click",M,false);d.addEventListener("click",_,false);b.addEventListener("click",D,false);w.addEventListener("click",A,false);E.addEventListener("click",P,false)}();c.prototype.remove=function(){this.target.removeEventListener(this.eventType,this.func,false)};h.prototype.setCoords=function(e,t){this.helper.setAttribute("x",e-3);this.helper.setAttribute("y",t-3);return this};h.prototype.setAction=function(e){this.helper.action=e;return this};h.prototype.setCursor=function(t){e.addClass(this.helper,t);return this};h.prototype.setId=function(e){this.helper.n=e;return this};var p=function(e,n){t.setIsDraw(true);this.params={x:e,y:n,width:0,height:0};this.href="";this.alt="";this.title="";this.g=document.createElementNS("http://www.w3.org/2000/svg","g");this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect");t.addNodeToSvg(this.g);this.g.appendChild(this.rect);this.g.obj=this;this.helpers={center:new h(this.g,e-this.params.width/2,n-this.params.height/2),top:new h(this.g,e-this.params.width/2,n-this.params.height/2),bottom:new h(this.g,e-this.params.width/2,n-this.params.height/2),left:new h(this.g,e-this.params.width/2,n-this.params.height/2),right:new h(this.g,e-this.params.width/2,n-this.params.height/2),top_left:new h(this.g,e-this.params.width/2,n-this.params.height/2),top_right:new h(this.g,e-this.params.width/2,n-this.params.height/2),bottom_left:new h(this.g,e-this.params.width/2,n-this.params.height/2),bottom_right:new h(this.g,e-this.params.width/2,n-this.params.height/2)};this.helpers.center.setAction("move").setCursor("move");this.helpers.left.setAction("editLeft").setCursor("e - resize");this.helpers.right.setAction("editRight").setCursor("w - resize");this.helpers.top.setAction("editTop").setCursor("n - resize");this.helpers.bottom.setAction("editBottom").setCursor("s - resize");this.helpers.top_left.setAction("editTopLeft").setCursor("nw - resize");this.helpers.top_right.setAction("editTopRight").setCursor("ne - resize");this.helpers.bottom_left.setAction("editBottomLeft").setCursor("sw - resize");this.helpers.bottom_right.setAction("editBottomRight").setCursor("se - resize");this.select().redraw();t.addObject(this)};p.prototype.setCoords=function(e){this.rect.setAttribute("x",e.x);this.rect.setAttribute("y",e.y);this.rect.setAttribute("width",e.width);this.rect.setAttribute("height",e.height);this.helpers.center.setCoords(e.x+e.width/2,e.y+e.height/2);this.helpers.top.setCoords(e.x+e.width/2,e.y);this.helpers.bottom.setCoords(e.x+e.width/2,e.y+e.height);this.helpers.left.setCoords(e.x,e.y+e.height/2);this.helpers.right.setCoords(e.x+e.width,e.y+e.height/2);this.helpers.top_left.setCoords(e.x,e.y);this.helpers.top_right.setCoords(e.x+e.width,e.y);this.helpers.bottom_left.setCoords(e.x,e.y+e.height);this.helpers.bottom_right.setCoords(e.x+e.width,e.y+e.height);return this};p.prototype.setParams=function(e){this.params.x=e.x;this.params.y=e.y;this.params.width=e.width;this.params.height=e.height;return this};p.prototype.redraw=function(){this.setCoords(this.params);return this};p.prototype.dynamicDraw=function(e,t,n){var r=this.params.x,i=this.params.y,s,o,u,a,f,l;u=Math.abs(e-r);a=Math.abs(t-i);if(n){f=u-a;if(f>0){u=a}else{a=u}}if(r>e){s=e;if(n&&f>0){s=e+Math.abs(f)}}else{s=r}if(i>t){o=t;if(n&&f<0){o=t+Math.abs(f)}}else{o=i}l={x:s,y:o,width:u,height:a};this.setCoords(l);return l};p.prototype.onDraw=function(n){var r=t.getNewArea(),i=n.shiftKey?true:false;r.dynamicDraw(e.rightX(n.pageX),e.rightY(n.pageY),i)};p.prototype.onDrawStop=function(n){var r=t.getNewArea(),i=n.shiftKey?true:false;r.setParams(r.dynamicDraw(e.rightX(n.pageX),e.rightY(n.pageY),i)).deselect();t.removeAllEvents().setIsDraw(false).resetNewArea()};p.prototype.move=function(e,t){var n=Object.create(this.params);n.x+=e;n.y+=t;return n};p.prototype.editLeft=function(e,t){var n=Object.create(this.params);n.x+=e;n.width-=e;return n};p.prototype.editRight=function(e,t){var n=Object.create(this.params);n.width+=e;return n};p.prototype.editTop=function(e,t){var n=Object.create(this.params);n.y+=t;n.height-=t;return n};p.prototype.editBottom=function(e,t){var n=Object.create(this.params);n.height+=t;return n};p.prototype.editTopLeft=function(e,t){var n=Object.create(this.params);n.x+=e;n.y+=t;n.width-=e;n.height-=t;return n};p.prototype.editTopRight=function(e,t){var n=Object.create(this.params);n.y+=t;n.width+=e;n.height-=t;return n};p.prototype.editBottomLeft=function(e,t){var n=Object.create(this.params);n.x+=e;n.width-=e;n.height+=t;return n};p.prototype.editBottomRight=function(e,t){var n=Object.create(this.params);n.width+=e;n.height+=t;return n};p.prototype.dynamicEdit=function(e,t){if(e.width<0){e.width=Math.abs(e.width);e.x-=e.width}if(e.height<0){e.height=Math.abs(e.height);e.y-=e.height}if(t){var n=this.params.width/this.params.height,r=e.width/e.height,i=r-n,s=this.params.x,o=this.params.y,u=e.x,a=e.y;if(i>0){e.width=Math.round(e.height*n)}else{e.height=Math.round(e.width/n)}}this.setCoords(e);return e};p.prototype.onEdit=function(e){var n=t.getSelectedArea(),r=t.getEditType(),i=e.shiftKey?true:false;n.dynamicEdit(n[r](e.pageX-n.delta.x,e.pageY-n.delta.y),i)};p.prototype.onEditStop=function(e){var n=t.getSelectedArea(),r=t.getEditType(),i=e.shiftKey?true:false;n.setParams(n.dynamicEdit(n[r](e.pageX-n.delta.x,e.pageY-n.delta.y),i));t.removeAllEvents()};p.prototype.remove=function(){t.removeNodeFromSvg(this.g)};p.prototype.select=function(){e.addClass(this.rect,"selected");return this};p.prototype.deselect=function(){e.removeClass(this.rect,"selected");return this};p.prototype.with_href=function(){e.addClass(this.rect,"with_href");return this};p.prototype.without_href=function(){e.removeClass(this.rect,"with_href");return this};p.prototype.toString=function(){var e=this.params.x+this.params.width,t=this.params.y+this.params.height;return'<area shape="rect" coords="'+this.params.x+", "+this.params.y+", "+e+", "+t+'"'+(this.href?' href="'+this.href+'"':"")+(this.alt?' alt="'+this.alt+'"':"")+(this.title?' title="'+this.title+'"':"")+" />"};p.createFromSaved=function(e){var n=e.coords,r=e.href,i=e.alt,s=e.title,o=new p(n[0],n[1]);o.setParams(o.dynamicDraw(n[2],n[3])).deselect();t.setIsDraw(false).resetNewArea();if(r){o.href=r}if(i){o.alt=i}if(s){o.title=s}};p.prototype.toJSON=function(){return{type:"rect",coords:[this.params.x,this.params.y,this.params.x+this.params.width,this.params.y+this.params.height],href:this.href,alt:this.alt,title:this.title}};var d=function(e,n){t.setIsDraw(true);this.params={cx:e,cy:n,radius:0};this.href="";this.alt="";this.title="";this.g=document.createElementNS("http://www.w3.org/2000/svg","g");this.circle=document.createElementNS("http://www.w3.org/2000/svg","circle");t.addNodeToSvg(this.g);this.g.appendChild(this.circle);this.g.obj=this;this.helpers={center:new h(this.g,e,n),top:new h(this.g,e,n),bottom:new h(this.g,e,n),left:new h(this.g,e,n),right:new h(this.g,e,n)};this.helpers.center.setAction("move");this.helpers.top.setAction("editTop").setCursor("n - resize");this.helpers.bottom.setAction("editBottom").setCursor("s - resize");this.helpers.left.setAction("editLeft").setCursor("w - resize");this.helpers.right.setAction("editRight").setCursor("e - resize");this.select().redraw();t.addObject(this)};d.prototype.setCoords=function(e){this.circle.setAttribute("cx",e.cx);this.circle.setAttribute("cy",e.cy);this.circle.setAttribute("r",e.radius);this.helpers.center.setCoords(e.cx,e.cy);this.helpers.top.setCoords(e.cx,e.cy-e.radius);this.helpers.right.setCoords(e.cx+e.radius,e.cy);this.helpers.bottom.setCoords(e.cx,e.cy+e.radius);this.helpers.left.setCoords(e.cx-e.radius,e.cy);return this};d.prototype.setParams=function(e){this.params.cx=e.cx;this.params.cy=e.cy;this.params.radius=e.radius;return this};d.prototype.redraw=function(){this.setCoords(this.params);return this};d.prototype.dynamicDraw=function(e,t){var n=this.params.cx,r=this.params.cy,i,s,o,u;e=e?e:n;t=t?t:r;i=Math.abs(n-e);s=Math.abs(r-t);o=Math.round(Math.sqrt(i*i+s*s));u={cx:n,cy:r,radius:o};this.setCoords(u);return u};d.prototype.onDraw=function(n){var r=t.getNewArea();r.dynamicDraw(e.rightX(n.pageX),e.rightY(n.pageY))};d.prototype.onDrawStop=function(n){var r=t.getNewArea();r.setParams(r.dynamicDraw(e.rightX(n.pageX),e.rightY(n.pageY))).deselect();t.removeAllEvents().setIsDraw(false).resetNewArea()};d.prototype.move=function(e,t){var n=Object.create(this.params);n.cx+=e;n.cy+=t;return n};d.prototype.editTop=function(e,t){var n=Object.create(this.params);n.radius-=t;return n};d.prototype.editBottom=function(e,t){var n=Object.create(this.params);n.radius+=t;return n};d.prototype.editLeft=function(e,t){var n=Object.create(this.params);n.radius-=e;return n};d.prototype.editRight=function(e,t){var n=Object.create(this.params);n.radius+=e;return n};d.prototype.dynamicEdit=function(e){if(e.radius<0){e.radius=Math.abs(e.radius)}this.setCoords(e);return e};d.prototype.onEdit=function(e){var n=t.getSelectedArea(),r=t.getEditType();n.dynamicEdit(n[r](e.pageX-n.delta.x,e.pageY-n.delta.y))};d.prototype.onEditStop=function(e){var n=t.getSelectedArea(),r=t.getEditType();n.setParams(n.dynamicEdit(n[r](e.pageX-n.delta.x,e.pageY-n.delta.y)));t.removeAllEvents()};d.prototype.remove=function(){t.removeNodeFromSvg(this.g)};d.prototype.select=function(){e.addClass(this.circle,"selected");return this};d.prototype.deselect=function(){e.removeClass(this.circle,"selected");return this};d.prototype.with_href=function(){e.addClass(this.circle,"with_href");return this};d.prototype.without_href=function(){e.removeClass(this.circle,"with_href");return this};d.prototype.toString=function(){return'<area shape="circle" coords="'+this.params.cx+", "+this.params.cy+", "+this.params.radius+'"'+(this.href?' href="'+this.href+'"':"")+(this.alt?' alt="'+this.alt+'"':"")+(this.title?' title="'+this.title+'"':"")+" />"};d.createFromSaved=function(e){var n=e.coords,r=e.href,i=e.alt,s=e.title,o=new d(n[0],n[1]);o.setParams(o.dynamicDraw(n[0],n[1]+n[2])).deselect();t.setIsDraw(false).resetNewArea();if(r){o.href=r}if(i){o.alt=i}if(s){o.title=s}};d.prototype.toJSON=function(){return{type:"circle",coords:[this.params.cx,this.params.cy,this.params.radius],href:this.href,alt:this.alt,title:this.title}};var v=function(e,n){t.setIsDraw(true);this.params=[e,n];this.href="";this.alt="";this.title="";this.g=document.createElementNS("http://www.w3.org/2000/svg","g");this.polygon=document.createElementNS("http://www.w3.org/2000/svg","polyline");t.addNodeToSvg(this.g);this.g.appendChild(this.polygon);this.g.obj=this;this.helpers=[new h(this.g,this.params[0],this.params[1])];this.helpers[0].setAction("pointMove").setCursor("pointer").setId(0);this.selected_point=-1;this.select().redraw();t.addObject(this)};v.prototype.setCoords=function(t){var n=t.join(" ");this.polygon.setAttribute("points",n);e.foreach(this.helpers,function(e,n){e.setCoords(t[2*n],t[2*n+1])});return this};v.prototype.setParams=function(e){this.params=e;return this};v.prototype.addPoint=function(e,t){var n=new h(this.g,e,t);n.setAction("pointMove").setCursor("pointer").setId(this.helpers.length);this.helpers.push(n);this.params.push(e,t);this.redraw();return this};v.prototype.redraw=function(){this.setCoords(this.params);return this};v.prototype.right_angle=function(e,t){var n=this.params[this.params.length-2],r=this.params[this.params.length-1],i=e-n,s=-(t-r),o=s/i;if(i>0&&s>0){if(o>2.414){e=n}else if(o<.414){t=r}else{Math.abs(i)>Math.abs(s)?e=n+s:t=r-i}}else if(i<0&&s>0){if(o<-2.414){e=n}else if(o>-.414){t=r}else{Math.abs(i)>Math.abs(s)?e=n-s:t=r+i}}else if(i<0&&s<0){if(o>2.414){e=n}else if(o<.414){t=r}else{Math.abs(i)>Math.abs(s)?e=n+s:t=r-i}}else if(i>0&&s<0){if(o<-2.414){e=n}else if(o>-.414){t=r}else{Math.abs(i)>Math.abs(s)?e=n-s:t=r+i}}return{x:e,y:t}};v.prototype.dynamicDraw=function(e,t,n){var r=[].concat(this.params);if(n){var i=this.right_angle(e,t);e=i.x;t=i.y}r.push(e,t);this.setCoords(r);return r};v.prototype.onDraw=function(n){var r=t.getNewArea();var i=n.shiftKey?true:false;r.dynamicDraw(e.rightX(n.pageX),e.rightY(n.pageY),i)};v.prototype.onDrawAddPoint=function(n){var r=e.rightX(n.pageX),i=e.rightY(n.pageY),s=t.getNewArea();if(n.shiftKey){var o=s.right_angle(r,i);r=o.x;i=o.y}s.addPoint(r,i)};v.prototype.onDrawStop=function(e){var n=t.getNewArea();if(e.type=="click"||e.type=="keydown"&&e.keyCode==13){if(n.params.length>=6){n.polyline=n.polygon;n.polygon=document.createElementNS("http://www.w3.org/2000/svg","polygon");n.g.replaceChild(n.polygon,n.polyline);n.setCoords(n.params).deselect();delete n.polyline;t.removeAllEvents().setIsDraw(false).resetNewArea()}}e.stopPropagation()};v.prototype.move=function(e,t){for(var n=0,r=this.params.length;n<r;n++){n%2?this.params[n]+=t:this.params[n]+=e}this.redraw()};v.prototype.pointMove=function(e,t){this.params[2*this.selected_point]+=e;this.params[2*this.selected_point+1]+=t;this.redraw()};v.prototype.onEdit=function(e){var n=t.getSelectedArea(),r=t.getEditType();n[r](e.pageX-n.delta.x,e.pageY-n.delta.y);n.delta.x=e.pageX;n.delta.y=e.pageY};v.prototype.onEditStop=function(e){var n=t.getSelectedArea(),r=t.getEditType();n[r](e.pageX-n.delta.x,e.pageY-n.delta.y);t.removeAllEvents()};v.prototype.remove=function(){t.removeNodeFromSvg(this.g)};v.prototype.select=function(){e.addClass(this.polygon,"selected");return this};v.prototype.deselect=function(){e.removeClass(this.polygon,"selected");return this};v.prototype.with_href=function(){e.addClass(this.polygon,"with_href");return this};v.prototype.without_href=function(){e.removeClass(this.polygon,"with_href");return this};v.prototype.toString=function(){for(var e=0,t=this.params.length,n="";e<t;e++){n+=this.params[e];if(e!=t-1){n+=", "}}return'<area shape="poly" coords="'+n+'"'+(this.href?' href="'+this.href+'"':"")+(this.alt?' alt="'+this.alt+'"':"")+(this.title?' title="'+this.title+'"':"")+" />"};v.createFromSaved=function(e){var n=e.coords,r=e.href,i=e.alt,s=e.title,o=new v(n[0],n[1]);for(var u=2,a=n.length;u<a;u+=2){o.addPoint(n[u],n[u+1])}o.polyline=o.polygon;o.polygon=document.createElementNS("http://www.w3.org/2000/svg","polygon");o.g.replaceChild(o.polygon,o.polyline);o.setCoords(o.params).deselect();delete o.polyline;t.setIsDraw(false).resetNewArea();if(r){o.href=r}if(i){o.alt=i}if(s){o.title=s}};v.prototype.toJSON=function(){return{type:"polygon",coords:this.params,href:this.href,alt:this.alt,title:this.title}}}document.addEventListener("DOMContentLoaded",SummerHtmlImageMapCreator,false)